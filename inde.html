<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Madurez de Marketing - AdLens</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        const { ChevronLeft, ChevronRight } = lucide;

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzX375YbKXIU064eMeys_quIwMhsiktPtT3cDrdnh9odYRs4V7zxjuzv9zjsWQv1-_Mng/exec';

        function App() {
            const [step, setStep] = useState('initial');
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({
                nombreAnunciante: '',
                razonSocial: '',
                ruc: '',
                nombreEncuestado: '',
                cargoEncuestado: '',
                emailEncuestado: '',
                nombreEncuestador: ''
            });
            const [answers, setAnswers] = useState({});
            const [result, setResult] = useState(null);

            const questions = [
                {id: 1, text: '¿Qué tan alineada está tu estrategia de marketing con los objetivos del negocio?', category: 'Estrategia y Cultura', type: 'multiple', options: ['No está alineada', 'Parcialmente alineada', 'Alineada a corto plazo', 'Totalmente integrada y sostenida']},
                {id: 2, text: '¿Existe una visión de marca clara y compartida internamente?', category: 'Estrategia y Cultura', type: 'multiple', options: ['No existe', 'Solo algunos la conocen', 'Existe pero no guía decisiones', 'Guía decisiones estratégicas']},
                {id: 3, text: '¿Con qué frecuencia revisan la estrategia de marca?', category: 'Estrategia y Cultura', type: 'multiple', options: ['Solo en emergencias', 'Cada 2-3 años', 'Revisión anual básica', 'Revisión anual profunda y colaborativa']},
                {id: 4, text: '¿Qué tan claro es el posicionamiento competitivo?', category: 'Estrategia y Cultura', type: 'multiple', options: ['No está definido', 'Idea general', 'Definido pero débil', 'Definido y diferencial']},
                {id: 5, text: '¿Qué tan autónomo es marketing para tomar decisiones?', category: 'Estrategia y Cultura', type: 'multiple', options: ['Sin autonomía', 'Autonomía limitada', 'Autonomía parcial', 'Alta autonomía estratégica']},
                {id: 6, text: '¿Qué tan abierta es la empresa a ideas innovadoras?', category: 'Estrategia y Cultura', type: 'multiple', options: ['Se evita innovar', 'Apertura parcial', 'Apertura moderada', 'Innovación como valor central']},
                {id: 7, text: '¿Cómo fluye la colaboración con otras áreas?', category: 'Estrategia y Cultura', type: 'multiple', options: ['Áreas aisladas', 'Solo cuando es urgente', 'Proyectos conjuntos', 'Integración fluida']},
                {id: 8, text: '¿Qué tan involucrado está marketing en las decisiones de negocio?', category: 'Tecnología y Datos', type: 'multiple', options: ['Operativo', 'Táctico', 'Funcional', 'Estratégico']},
                {id: 9, text: 'Nivel de uso de herramientas digitales/automatización', category: 'Tecnología y Datos', type: 'multiple', options: ['No usamos', 'Uso puntual', 'Uso en algunas campañas', 'Uso avanzado y sistemático']},
                {id: 10, text: 'Gestión de información de clientes (CRM)', category: 'Tecnología y Datos', type: 'multiple', options: ['No hay CRM', 'CRM sin integración', 'Integración parcial', 'CRM integrado']},
                {id: 11, text: 'Seguimiento de resultados', category: 'Tecnología y Datos', type: 'multiple', options: ['No se mide', 'Reportes finales', 'Reportes periódicos', 'Dashboards automáticos']},
                {id: 12, text: 'Preparación para nuevas tecnologías (IA, automatización)', category: 'Tecnología y Datos', type: 'multiple', options: ['Sin interés', 'Interés sin pruebas', 'Pilotos', 'Implementación activa']},
                {id: 13, text: '¿Qué tanto se basan en datos las campañas?', category: 'Tecnología y Datos', type: 'multiple', options: ['Sin datos', 'Solo en campañas grandes', 'Se usan insights', 'Siempre basadas en datos']},
                {id: 14, text: 'Proceso creativo interno', category: 'Ejecución y Operaciones', type: 'multiple', options: ['Improvisado', 'Pautas básicas', 'Colaborativo', 'Estructurado']},
                {id: 15, text: 'Multicanalidad', category: 'Ejecución y Operaciones', type: 'multiple', options: ['Un canal', 'Dos canales puntuales', 'Multicanal básico', 'Multicanal integrado']},
                {id: 16, text: 'Velocidad de ajuste de campañas', category: 'Ejecución y Operaciones', type: 'multiple', options: ['No se ajusta', 'Ajuste lento', 'Ajustes según KPIs', 'Iteración rápida']},
                {id: 17, text: 'Segmentación de clientes', category: 'Cliente y Personalización', type: 'multiple', options: ['No segmentamos', 'Por percepciones', 'Segmentos básicos', 'Basada en datos reales']},
                {id: 18, text: 'Mapeo de Customer Journey', category: 'Cliente y Personalización', type: 'multiple', options: ['No existe', 'Intentos aislados', 'Mapeos parciales', 'Recorridos completos']},
                {id: 19, text: 'Recolección de información del cliente', category: 'Cliente y Personalización', type: 'multiple', options: ['No hay mecanismos', 'Encuestas ocasionales', 'Herramientas por proyecto', 'Sistema regular']},
                {id: 20, text: 'Personalización de la comunicación', category: 'Cliente y Personalización', type: 'multiple', options: ['Estándar', 'Básica', 'Campañas segmentadas', 'Personalización multicanal']},
                {id: 21, text: '¿Qué pesa más al decidir en marketing?', category: 'Toma de Decisiones', type: 'multiple', options: ['Intuición', 'Experiencia', 'Datos + intuición', 'Datos + visión futura']},
                {id: 22, text: 'Velocidad cultural', category: 'Toma de Decisiones', type: 'scale', min: 1, max: 10, minLabel: 'Poca', maxLabel: 'Mucha'},
                {id: 23, text: 'Confianza con proveedores/agencias', category: 'Toma de Decisiones', type: 'multiple', options: ['Baja', 'Media', 'Alta', 'Muy alta']},
                {id: 24, text: 'Ambición de marca', category: 'Toma de Decisiones', type: 'multiple', options: ['Mantenerse', 'Crecer', 'Transformar categoría', 'Liderar mercado']},
                {id: 25, text: 'Las iniciativas son más arriesgadas o conservadoras', category: 'Toma de Decisiones', type: 'scale', min: 1, max: 10, minLabel: 'Conservadoras', maxLabel: 'Arriesgadas'}
            ];

            const handleInputChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const handleStartTest = () => {
                if (Object.values(formData).every(v => v.trim() !== '')) {
                    setStep('questions');
                    setCurrentQuestion(0);
                }
            };

            const handleAnswerChange = (questionId, value) => {
                setAnswers({
                    ...answers,
                    [questionId]: value
                });
            };

            const handleNext = () => {
                if (currentQuestion < questions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                } else {
                    handleSubmit();
                }
            };

            const handlePrevious = () => {
                if (currentQuestion > 0) {
                    setCurrentQuestion(currentQuestion - 1);
                }
            };

            const handleSubmit = async () => {
                setLoading(true);
                setStep('loading');

                try {
                    let score = 0;
                    questions.forEach(q => {
                        const answer = answers[q.id];
                        if (q.type === 'multiple') {
                            const index = q.options.indexOf(answer);
                            score += index >= 0 ? index : 0;
                        } else if (q.type === 'scale') {
                            const value = parseInt(answer) || 5;
                            score += (value / q.max) * 3;
                        }
                    });

                    const avgScore = score / questions.length;
                    let nivel, narrativa;

                    if (avgScore < 1) {
                        nivel = 'Empresa Inicial o Operativa';
                        narrativa = 'Tu empresa se encuentra en una etapa temprana de madurez en marketing. Las acciones suelen ser operativas o reactivas, sin planificación estructurada ni uso consistente de herramientas o datos. No hay roles definidos claramente y el marketing no participa activamente en decisiones estratégicas. Este diagnóstico representa una gran oportunidad: construir desde esta base permite incorporar capacidades, definir procesos y fortalecer el pensamiento estratégico de forma progresiva.';
                    } else if (avgScore < 2) {
                        nivel = 'Empresa en Evolución';
                        narrativa = 'Tu organización está en plena transición hacia una gestión más madura del marketing. Ya existe cierta estructura o equipo, y posiblemente haya campañas en marcha, pero la estrategia no está del todo clara o consistente. La inversión es táctica, el uso de tecnología limitada y la cultura interna aún no se orienta completamente al marketing. Estás en una zona fértil para construir capacidades, definir roles y fortalecer el pensamiento estratégico.';
                    } else if (avgScore < 2.5) {
                        nivel = 'Empresa Avanzada y Creativa';
                        narrativa = 'Estás en un nivel alto de desarrollo. Tu empresa tiene un equipo de marketing profesionalizado, campañas frecuentes y buena capacidad de ejecución. Aunque aún puede haber desafíos en integración o visión estratégica total, tu sensibilidad de marca, creatividad y cultura colaborativa te posicionan con mucho potencial. Pequeños ajustes pueden llevarte al siguiente nivel.';
                    } else {
                        nivel = 'Líder Estratégico';
                        narrativa = 'Tu empresa opera con una madurez de marketing sobresaliente. Contás con una estrategia bien definida, alineada al negocio y proyectada a largo plazo. Tenés autonomía, tecnología integrada, medición constante, creatividad aplicada y una inversión coherente con tus objetivos. Marketing participa activamente en decisiones estratégicas y se convierte en una ventaja competitiva clara.';
                    }

                    const resultData = { nivel, narrativa };
                    setResult(resultData);
                    setStep('results');

                    // Enviar a Google Sheets
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = GOOGLE_SCRIPT_URL;
                    form.target = '_blank';
                    
                    const input1 = document.createElement('input');
                    input1.type = 'hidden';
                    input1.name = 'formData';
                    input1.value = JSON.stringify(formData);
                    
                    const input2 = document.createElement('input');
                    input2.type = 'hidden';
                    input2.name = 'answers';
                    input2.value = JSON.stringify(answers);
                    
                    const input3 = document.createElement('input');
                    input3.type = 'hidden';
                    input3.name = 'result';
                    input3.value = JSON.stringify(resultData);
                    
                    form.appendChild(input1);
                    form.appendChild(input2);
                    form.appendChild(input3);
                    
                    document.body.appendChild(form);
                    form.submit();
                    setTimeout(() => document.body.removeChild(form), 1000);

                } catch (error) {
                    console.error('Error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const progress = ((currentQuestion + 1) / questions.length) * 100;
            const currentQ = questions[currentQuestion];

            if (step === 'initial') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 flex items-center justify-center p-4">
                        <div className="bg-purple-800/50 backdrop-blur-sm rounded-3xl p-8 max-w-2xl w-full shadow-2xl">
                            <div className="text-center mb-8">
                                <h1 className="text-5xl font-bold text-white mb-2">AdLens</h1>
                                <div className="h-1 w-32 bg-orange-500 mx-auto mb-6"></div>
                                <h2 className="text-3xl font-semibold text-white mb-4">Test de Madurez de Marketing</h2>
                                <p className="text-purple-200 text-lg">Evalúa el nivel de madurez de marketing de tu empresa</p>
                            </div>

                            <p className="text-orange-400 text-center mb-6 font-medium">Todos los campos son obligatorios</p>

                            <div className="space-y-4">
                                <input type="text" name="nombreAnunciante" placeholder="Nombre del Anunciante (como está en Ibope)" value={formData.nombreAnunciante} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                                <input type="text" name="razonSocial" placeholder="Razón Social" value={formData.razonSocial} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                                <input type="text" name="ruc" placeholder="RUC (con guion y dígito verificador)" value={formData.ruc} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                                <input type="text" name="nombreEncuestado" placeholder="Nombre del encuestado" value={formData.nombreEncuestado} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                                <input type="text" name="cargoEncuestado" placeholder="Cargo del encuestado dentro de la empresa" value={formData.cargoEncuestado} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                                <input type="email" name="emailEncuestado" placeholder="Email del encuestado" value={formData.emailEncuestado} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                                <input type="text" name="nombreEncuestador" placeholder="Nombre del encuestador" value={formData.nombreEncuestador} onChange={handleInputChange} className="w-full px-6 py-4 bg-purple-700/50 border-2 border-purple-600 rounded-xl text-white placeholder-purple-300 focus:outline-none focus:border-orange-500" />
                            </div>

                            <button onClick={handleStartTest} disabled={!Object.values(formData).every(v => v.trim() !== '')} className="w-full mt-8 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-500 disabled:cursor-not-allowed text-white font-bold py-4 px-8 rounded-xl text-xl transition-colors shadow-lg">
                                Comenzar Test
                            </button>
                        </div>
                    </div>
                );
            }

            if (step === 'loading') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 flex items-center justify-center p-4">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-4 border-orange-500 border-t-transparent mx-auto mb-4"></div>
                            <p className="text-white text-xl">Analizando tus respuestas...</p>
                        </div>
                    </div>
                );
            }

            if (step === 'results') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 p-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-8">
                                <h1 className="text-5xl font-bold text-white mb-8">Resultados</h1>
                                <h2 className="text-3xl font-bold text-white mb-2">{formData.nombreAnunciante}</h2>
                                <p className="text-purple-200 text-lg">{formData.razonSocial}</p>
                                <p className="text-purple-300">Encuestado: {formData.nombreEncuestado}</p>
                            </div>

                            <div className="bg-green-900/30 border-2 border-green-600 rounded-xl p-4 mb-8">
                                <p className="text-green-300 text-center">✓ Tu encuesta ha sido guardada en Google Sheets automáticamente.</p>
                            </div>

                            <div className="bg-purple-800/50 backdrop-blur-sm rounded-3xl p-8 shadow-2xl mb-8">
                                <h2 className="text-4xl font-bold text-orange-500 text-center mb-8">{result?.nivel}</h2>
                                <div className="text-white text-lg leading-relaxed">
                                    <p>{result?.narrativa}</p>
                                </div>
                            </div>

                            <button onClick={() => { setStep('initial'); setCurrentQuestion(0); setAnswers({}); setFormData({ nombreAnunciante: '', razonSocial: '', ruc: '', nombreEncuestado: '', cargoEncuestado: '', emailEncuestado: '', nombreEncuestador: '' }); }} className="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-xl text-xl transition-colors shadow-lg">
                                Nueva Encuesta
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 p-4">
                    <div className="max-w-3xl mx-auto pt-8">
                        <div className="bg-purple-800/50 backdrop-blur-sm rounded-3xl p-8 shadow-2xl">
                            <div className="mb-6">
                                <div className="flex justify-between text-orange-400 font-semibold mb-2">
                                    <span>Pregunta {currentQuestion + 1} de {questions.length}</span>
                                    <span>{currentQ.category}</span>
                                </div>
                                <div className="w-full bg-purple-700 rounded-full h-3 overflow-hidden">
                                    <div className="bg-orange-500 h-full transition-all duration-300" style={{ width: `${progress}%` }}></div>
                                </div>
                            </div>

                            <h2 className="text-2xl font-semibold text-white mb-8">{currentQ.text}</h2>

                            {currentQ.type === 'multiple' && (
                                <div className="space-y-4 mb-8">
                                    {currentQ.options.map((option, idx) => (
                                        <button key={idx} onClick={() => handleAnswerChange(currentQ.id, option)} className={`w-full text-left px-6 py-4 rounded-xl font-medium transition-all ${answers[currentQ.id] === option ? 'bg-orange-500 text-white shadow-lg' : 'bg-purple-700/50 text-white hover:bg-purple-600/50'}`}>
                                            {option}
                                        </button>
                                    ))}
                                </div>
                            )}

                            {currentQ.type === 'scale' && (
                                <div className="mb-8">
                                    <div className="flex justify-between text-white mb-4">
                                        <span>{currentQ.minLabel}</span>
                                        <span>{currentQ.maxLabel}</span>
                                    </div>
                                    <input type="range" min={currentQ.min} max={currentQ.max} value={answers[currentQ.id] || Math.floor((currentQ.min + currentQ.max) / 2)} onChange={(e) => handleAnswerChange(currentQ.id, e.target.value)} className="w-full h-3 bg-purple-700 rounded-lg appearance-none cursor-pointer accent-orange-500" />
                                    <div className="text-center mt-4">
                                        <span className="text-5xl font-bold text-orange-500">{answers[currentQ.id] || Math.floor((currentQ.min + currentQ.max) / 2)}</span>
                                    </div>
                                </div>
                            )}

                            <div className="flex gap-4">
                                <button onClick={handlePrevious} disabled={currentQuestion === 0} className="flex-1 flex items-center justify-center gap-2 bg-purple-700 hover:bg-purple-600 disabled:bg-purple-900 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-xl transition-colors">
                                    <ChevronLeft size={20} />
                                    Anterior
                                </button>
                                <button onClick={handleNext} disabled={!answers[currentQ.id]} className="flex-1 flex items-center justify-center gap-2 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-500 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-xl transition-colors">
                                    {currentQuestion === questions.length - 1 ? 'Finalizar' : 'Siguiente'}
                                    <ChevronRight size={20} />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
